<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="LitterQer both cute and handsome">
  <meta name="keyword" content="java, mySQL">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Generic Basics | LitterQer
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 6.2.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>LitterQer</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>Generic Basics</h2>
  <p class="post-date">2022-07-21</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="泛型程序设计"><a href="#泛型程序设计" class="headerlink" title="泛型程序设计"></a>泛型程序设计</h1><h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><p>一般使用T，E，K，V这类具有明确意义的字母，但是也可以使用其他字母，只要表达出意思即可。使用的时候一般就是用&lt;&gt;括起来。比如可以限制一个ArrayList内部元素种类，通过<code>&lt;String&gt;</code>就可以保证里面只包含String。这里需要注意的就是内部的元素必须为类名，不可以是primitive类型。但是由于java中的语法糖会帮助我们自动装箱和拆箱，所以直接使用wrapper的类即可。当然除了这些以外，在设计一个泛型程序的时候也可以使用多个这样的通配符，比如我可以设计一个键值对，那么它的定义方式就应该是&lt;K, V&gt;。这里K表示key，而V表示value。虽然我没有明确定义他们的具体类型，但是我可以保证key的类型是一样的，同样value的类型也是一样的。</p>
<h2 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h2><p>和前面的思路一样，一般用于处理无法预测的入参。比如设计的程序中出现了要找到某一个数组的中间位置。由于不清楚这个数组的具体类型，在设计的时候就可以直接只用泛型来定义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getMiddle</span><span class="params">(T[] ts)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ts[ts.length/<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在定义泛型方法的时候要注意在修饰符后面加入<code>&lt;T&gt;</code>表示这是一个泛型方法。由于这里是找某一个数组的中间位置的值，所以输出也要调整为T。从这个例子中就可以看出泛型设计的优势，因为在使用这个方法前我并不知道具体的数组类型，按照没有泛型的写法。我需要设计很多个相对应方法，并且每个方法除了参数不同，方法体完全一样，这无疑是浪费时间，而且不够优雅。但是使用泛型我就可以把他们直接整合在一起。<br>使用泛型方法的时候也要注意一些小的细节。比如下面的例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] names = &#123;<span class="string">&quot;hash&quot;</span>,<span class="string">&quot;jon&quot;</span>,<span class="string">&quot;jeff&quot;</span>,<span class="string">&quot;ryan&quot;</span>,<span class="string">&quot;ashe&quot;</span>,<span class="string">&quot;zood&quot;</span>,<span class="string">&quot;tom&quot;</span>&#125;;</span><br><span class="line"><span class="type">String</span> <span class="variable">middle</span> <span class="operator">=</span> GenericDesign.&lt;String&gt;getMiddle(names);</span><br></pre></td></tr></table></figure>

<p>严格意义上说，我们需要在调用方法前加入要使用的类型名。但是这样一来就失去了泛型所带来的意义了，因为本来我就希望他是泛化的东西，现在我又让他强行地变成一个具体的类型。所以这里有一个体现了java的美好，这里编译器其实会提示不需要写入<code>&lt;String&gt;</code>，因为放入方法中的东西本身就是string数组，所以IDEA和编译器会自动把string带入方法，如此就又保证了泛型的设计理念。虽然我知道输出的一定是string，但是调用方法时候，我不需要知道。但是这样的做法并不是每次都能成功，比如下面这个例子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">middle2</span> <span class="operator">=</span> GenericDesign.getMiddle(<span class="number">1.2</span>,<span class="number">5</span>,<span class="number">0.5</span>);</span><br></pre></td></tr></table></figure>

<p>尝试把一个这样的数组放入泛型方法中，IDEA会直接报错，告诉你编译不可通过。这里的原因也很简单，因为编译器打包参数是，会尽量选择最合适的。如此5就会直接被改成Integer，而且剩下的则是Double。泛型方法虽然规定了可以又不用的参数类型，但是同一个通配符的类型必须一致，这也就说明了这里Integer和Double不一致，所以导致了编译不通过。那么解决的方案也很简单，只需要强制向上转置成double即可。</p>
<h2 id="类型变量的限定"><a href="#类型变量的限定" class="headerlink" title="类型变量的限定"></a>类型变量的限定</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&gt; T <span class="title function_">min</span><span class="params">(T[] ts)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ts == <span class="literal">null</span> || ts.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">T</span> <span class="variable">smallest</span> <span class="operator">=</span> ts[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (T t : ts) &#123;</span><br><span class="line">        <span class="keyword">if</span>(t.compareTo(smallest) &lt; <span class="number">0</span>) smallest = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> smallest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在定义上述的泛型方法时，我采取了一个<code>&lt;T extends Comparable&gt;</code>的方式。这里主要是因为需要比较，而我又不想带额外定义一个comparator。这种情况下，为了使用compareTo这个方法，我就必须保证我输入的类型必须可以被比较。那么根据之前使用的经验，直接继承Comparable这个类，由于comparable这个接口本身就是一个泛型类。更是完全契合了这里的方法。但是这里仍然要注意，如果把一个没有时间comparable的类尝试放入这个方法，编译器会直接报错。当然这里也用了extends关键字而非implements。这是java的一个小设计吧，所有这种方式的泛型限定都只使用extends来作为限定。如果实现接口的话，只需要使用&amp;隔开即可。这里特别需要注意的是，如果使用的是类，因为java中的单一继承原则。只能放入一个类，且这个类必须放在第一个。</p>
<h2 id="JVM如何看待泛型"><a href="#JVM如何看待泛型" class="headerlink" title="JVM如何看待泛型"></a>JVM如何看待泛型</h2><p>其实在JVM中压根就没有泛型的概念，它不过只是把泛型当成其他的普通类来处理。我们可以看下面的反编译结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> 0 aload_0</span><br><span class="line"> 1 aload_1</span><br><span class="line"> 2 invokespecial #13 &lt;Pair.&lt;init&gt; : (Ljava/lang/Object;)V&gt;</span><br><span class="line"> 5 aload_0</span><br><span class="line"> 6 aload_2</span><br><span class="line"> 7 putfield #16 &lt;Pair.second : Ljava/lang/Object;&gt;</span><br><span class="line">10 return</span><br></pre></td></tr></table></figure>

<p>这段代码是对Pair中的构造器进行的反编译结果，可以很明确地看出，JVM并没有把泛型当作是一个类型使用，而是直接使用Object作为变量的类型。实际上使用的使用的也是这样，JVM会把原始类型（raw type）直接替换为限定的类型（Object）。这个过程被叫做擦除。这里具体可以看下面的结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">16 invokevirtual #22 &lt;Pair.getFirst : ()Ljava/lang/Object;&gt;</span><br><span class="line">19 checkcast #26 &lt;java/lang/String&gt;</span><br><span class="line">22 aload_1</span><br><span class="line">23 invokevirtual #28 &lt;Pair.getSecond : ()Ljava/lang/Object;&gt;</span><br><span class="line">26 checkcast #26 &lt;java/lang/String&gt;</span><br><span class="line">29 invokedynamic #31 &lt;makeConcatWithConstants, BootstrapMethods #0&gt;</span><br><span class="line">34 invokevirtual #35 &lt;java/io/PrintStream.println : (Ljava/lang/String;)V&gt;</span><br><span class="line">37 return</span><br></pre></td></tr></table></figure>

<p>这里是对GenericDesign类中的第一部分反编译的结果。可以看到JVM在返回类型的时候，其实还是先返回了Object类，再强制转成String。而并非一开始就转成String。虽然编译器可以直接预测结果类型，但是JVM压根就不理解，它只能通过先<strong>擦除</strong>raw type的方式把输出转为object，然后再改写成string类。</p>
<h2 id="通配符扩展"><a href="#通配符扩展" class="headerlink" title="通配符扩展"></a>通配符扩展</h2><p>虽然一般情况下直接使用<code>&lt;T&gt;</code>就可以解决大部分的泛型方法设计问题，但是如果遇上了以下问题的话，那么普通的泛型设计就无法使用了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">300</span>);</span><br><span class="line"><span class="type">Student</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">400</span>);</span><br><span class="line">printMaxMin(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;Student&gt;(c,d));</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printMaxMin</span><span class="params">(Pair&lt;Person&gt; pair)</span>&#123;</span><br><span class="line">    System.out.println(pair.getFirst());</span><br><span class="line">    System.out.println(pair.getSecond());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我尝试使用把Student作为Pair的类型变量放入这个方法中时，编译器告诉我这里是不对的。即使我规定了Student已经是Person的子类，但是编译器仍然无法通过。这里的原因其实就是刚才对JVM的分析,虽然看上去它是泛型的，但是实际上JVM并不理解这个概念。那么这里java也有解决方案——通配符的变化。直接将上面的方法入参改为<code>Pair&lt;? extends Person&gt; pair</code>,这里？实际上就表示所有可能的子类，也就是说如果我再使用一个继承了Person的类，仍然可以直接使用。当然解决这个问题方法有很多，也可以在调用的时候直接省略&lt;&gt;中的内容。那样的话JVM就会自动找寻匹配的项，如果可以保证Pair中的类型正确的话，那么结果就是正确的。<br>既然可以出现子类的限定，那么肯定也有父类的限定。一般父类的限定使用&lt;? super ClassName&gt;。其他和前面一致。</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Java, Generic Design" >
    <span class="tag-code">Java, Generic Design</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2022/07/20/Java-Exception-Handling/">
        <span class="nav-arrow">← </span>
        
          Java Exception Handling
        
      </a>
    
    
      <a class="nav-right" href="/2022/07/21/Hexo-Settings/">
        
          Hexo 入门
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
    <!-- 二维码 END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js"
        repo=""
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E6%B3%9B%E5%9E%8B%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="toc-nav-text">泛型程序设计</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-nav-text">通配符</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95"><span class="toc-nav-text">泛型方法</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E7%9A%84%E9%99%90%E5%AE%9A"><span class="toc-nav-text">类型变量的限定</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#JVM%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E6%B3%9B%E5%9E%8B"><span class="toc-nav-text">JVM如何看待泛型</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%89%A9%E5%B1%95"><span class="toc-nav-text">通配符扩展</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://litterqer.github.io/2022/07/21/Generic-Basics/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>